# See https://pre-commit.com for more information
# See https://pre-commit.com/hooks.html for more hooks

# Minimum pre-commit version
minimum_pre_commit_version: "3.5.0"

# Default stages to run
default_stages: [pre-commit, pre-push]

# Fail fast - stop on first failure
fail_fast: false

repos:
  # =============================================================================
  # GENERAL FILE CHECKS
  # =============================================================================
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.5.0
    hooks:
      # File metadata
      - id: check-ast
        name: "Check Python AST"
        description: "Simply check whether files parse as valid python."
        
      - id: check-builtin-literals
        name: "Check builtin literals"
        description: "Require literal syntax when initializing empty or zero Python builtin types."
        
      - id: check-case-conflict
        name: "Check for case conflicts"
        description: "Check for files that would conflict in case-insensitive filesystems."
        
      - id: check-docstring-first
        name: "Check docstring first"
        description: "Checks a common error of defining a docstring after code."
        
      - id: check-json
        name: "Check JSON"
        description: "Attempts to load all json files to verify syntax."
        
      - id: check-toml
        name: "Check TOML"
        description: "Attempts to load all TOML files to verify syntax."
        
      - id: check-yaml
        name: "Check YAML"
        description: "Attempts to load all yaml files to verify syntax."
        
      - id: check-merge-conflict
        name: "Check for merge conflicts"
        description: "Check for files that contain merge conflict strings."
        
      - id: check-symlinks
        name: "Check for broken symlinks"
        description: "Checks for symlinks which do not point to anything."
        
      - id: check-xml
        name: "Check XML"
        description: "Attempts to load all xml files to verify syntax."
        
      # File quality
      - id: debug-statements
        name: "Debug statements check"
        description: "Check for debugger imports and py37+ breakpoint() calls in python source."
        
      - id: detect-private-key
        name: "Detect private keys"
        description: "Checks for the existence of private keys."
        
      - id: end-of-file-fixer
        name: "Fix end of files"
        description: "Makes sure files end in a newline and only a newline."
        
      - id: fix-byte-order-marker
        name: "Fix UTF-8 byte order marker"
        description: "Removes UTF-8 byte order marker."
        
      - id: mixed-line-ending
        name: "Mixed line ending"
        description: "Replaces or checks mixed line ending."
        args: [--fix=lf]
        
      - id: trailing-whitespace
        name: "Trim trailing whitespace"
        description: "Trims trailing whitespace."
        args: [--markdown-linebreak-ext=md]
        
      # File size
      - id: check-added-large-files
        name: "Check for large files"
        description: "Prevent giant files from being committed."
        args: [--maxkb=1000]

  # =============================================================================
  # BLACK - CODE FORMATTER
  # =============================================================================
  - repo: https://github.com/psf/black
    rev: 24.2.0
    hooks:
      - id: black
        name: "Black - Code Formatter"
        description: "Run Black on all Python files"
        language_version: python3.11
        types: [python]
        args: [
          --line-length=88,
          --target-version=py311,
          --target-version=py312,
        ]
        stages: [pre-commit]
        
      - id: black-jupyter
        name: "Black - Jupyter Notebooks"
        description: "Run Black on all Jupyter notebook files"
        language_version: python3.11
        types: [jupyter]
        args: [
          --line-length=88,
          --target-version=py311,
        ]
        stages: [pre-commit]

  # =============================================================================
  # RUFF - LINTER AND CODE CHECKER
  # =============================================================================
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.3.0
    hooks:
      # Ruff linter - check code quality
      - id: ruff
        name: "Ruff - Linter"
        description: "Run Ruff linter on all Python files"
        types: [python]
        args: [
          --fix,
          --exit-non-zero-on-fix,
        ]
        stages: [pre-commit]
        
      # Ruff formatter - additional formatting checks
      - id: ruff-format
        name: "Ruff - Formatter"
        description: "Run Ruff formatter on all Python files"
        types: [python]
        stages: [pre-commit]

  # =============================================================================
  # ADDITIONAL CHECKS
  # =============================================================================
  # Bandit - Security linter
  - repo: https://github.com/PyCQA/bandit
    rev: 1.7.7
    hooks:
      - id: bandit
        name: "Bandit - Security checks"
        description: "Find common security issues in Python code"
        args: [
          -c, pyproject.toml,
          -ll,  # Report only high-severity issues
        ]
        exclude: 
          ^tests/
          ^tests_ui/

  # Additional Python checks
  - repo: https://github.com/asottile/pyupgrade
    rev: v3.15.1
    hooks:
      - id: pyupgrade
        name: "Pyupgrade - Python upgrade checks"
        description: "Automatically upgrade syntax for newer versions of the language"
        args: [--py311-plus]
        types: [python]

  # Spell checker
  - repo: https://github.com/codespell-project/codespell
    rev: v2.2.6
    hooks:
      - id: codespell
        name: "Codespell - Spell checker"
        description: "Check for common misspellings in text files"
        args: [
          --write-changes,
          --ignore-words-list=ba,nin,ans,
        ]
        exclude: 
          (?x)^(
            .*\.lock|
            poetry\.lock|
            yarn\.lock|
            package-lock\.json|
            .*\.min\.(js|css)$
          )$

  # =============================================================================
  # LOCAL HOOKS (Custom checks)
  # =============================================================================
  # Run tests (optional - can be slow)
  # - repo: local
  #   hooks:
  #     - id: run-tests
  #       name: "Run tests"
 #       entry: python -m pytest tests/ -x -q --tb=line
  #       language: system
  #       types: [python]
  #       pass_filenames: false
  #       always_run: true
  #       stages: [pre-push]
  #       verbose: true
